Name:		@PACKAGE_NAME@
Version:	@PACKAGE_VERSION@
Release:	0@PRERELEASE_VERSION@%{?dist}
Summary:	GSSAPI Proxy

Group:		System Environment/Libraries
License:	MIT
URL:		http://fedorahosted.org/gss-proxy
Source0:	http://fedorahosted.org/released/gss-proxy/%{name}-%{version}.tar.gz
BuildRoot:	%(mktemp -ud %{_tmppath}/%{name}-%{version}-%{release}-XXXXXX)

%global servicename gssproxy
%global pubconfpath %{_sysconfdir}/gssproxy

### Patches ###

### Dependencies ###

Requires: krb5-libs >= 1.11.1
Requires: keyutils-libs

### Build Dependencies ###

BuildRequires: autoconf
BuildRequires: automake
BuildRequires: libtool
BuildRequires: m4
BuildRequires: libxslt
BuildRequires: libxml2
BuildRequires: docbook-style-xsl
BuildRequires: doxygen
BuildRequires: gettext-devel
BuildRequires: pkgconfig
BuildRequires: krb5-devel
BuildRequires: libselinux-devel
BuildRequires: keyutils-libs-devel
BuildRequires: iniparser-devel
BuildRequires: libverto-devel
BuildRequires: popt-devel
BuildRequires: findutils


%description
A proxy for GSSAPI credential handling

%prep
%setup -q


%build
cd proxy
autoreconf -f -i
%configure \
    --with-pubconf-path=%{pubconfpath} \
    --with-init-dir=%{_initrddir} \
    --disable-static \
    --disable-rpath

make %{?_smp_mflags} all


%install
rm -rf $RPM_BUILD_ROOT
cd proxy
make install DESTDIR=$RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT/%{_sysconfdir}/gssproxy
install -m644 examples/gssproxy-example.conf $RPM_BUILD_ROOT%{_sysconfdir}/gssproxy/gssproxy.conf

%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
#%{_initrddir}/%{name}
%{_sbindir}/gssproxy
%attr(755,root,root) %dir %{pubconfpath}
%attr(0600,root,root) %config(noreplace) /%{_sysconfdir}/gssproxy/gssproxy.conf
%{_libdir}/gssproxy/proxymech.so
%{_mandir}/man5/gssproxy.conf.5*
%{_mandir}/man8/gssproxy.8*

%post
/sbin/ldconfig
/sbin/chkconfig --add %{servicename}

if [ $1 -ge 1 ] ; then
    /sbin/service %{servicename} condrestart 2>&1 > /dev/null
fi

%preun
if [ $1 = 0 ]; then
    /sbin/service %{servicename} stop 2>&1 > /dev/null
    /sbin/chkconfig --del %{servicename}
fi

%changelog
* Fri Mar 22 2013 Guenther Deschner <gdeschner@redhat.com> - @PACKAGE_VERSION@-0@PRERELEASE_VERSION@
- Various specfile and packaging fixes

* Mon Dec 12 2011 Simo Sorce <simo@redhat.com> - 0.0.1-0
- Automated build of the gssproxy daemon
